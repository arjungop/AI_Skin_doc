# AI Doctor Skin Lesion - Azure Developer CLI Configuration
name: ai-doctor-skin-lesion
metadata:
  template: ai-doctor-skin-lesion@0.0.1-beta
  
# Deployment configuration
infra:
  provider: bicep
  path: ./infra

# Services to deploy
services:
  # Backend API Service
  api:
    project: ./backend
    language: python
    host: containerapp
    docker:
      path: ./backend/Dockerfile
      context: ./backend
    env:
      AZURE_SQL_CONNECTION_STRING: ${AZURE_SQL_CONNECTION_STRING}
      AZURE_STORAGE_CONNECTION_STRING: ${AZURE_STORAGE_CONNECTION_STRING}
      AZURE_OPENAI_ENDPOINT: ${AZURE_OPENAI_ENDPOINT}
      AZURE_OPENAI_API_KEY: ${AZURE_OPENAI_API_KEY}
      AZURE_AD_TENANT_ID: ${AZURE_AD_TENANT_ID}
      AZURE_AD_CLIENT_ID: ${AZURE_AD_CLIENT_ID}
      APPLICATIONINSIGHTS_CONNECTION_STRING: ${APPLICATIONINSIGHTS_CONNECTION_STRING}

  # Frontend React App
  web:
    project: ./frontend-react
    language: js
    host: staticwebapp
    dist: dist
    env:
      VITE_API_BASE_URL: ${API_BASE_URL}
      VITE_AZURE_AD_CLIENT_ID: ${AZURE_AD_CLIENT_ID}
      VITE_AZURE_AD_TENANT_ID: ${AZURE_AD_TENANT_ID}

  # Azure Functions for serverless operations
  functions:
    project: ./functions
    language: python
    host: function
    env:
      AZURE_SQL_CONNECTION_STRING: ${AZURE_SQL_CONNECTION_STRING}
      AZURE_STORAGE_CONNECTION_STRING: ${AZURE_STORAGE_CONNECTION_STRING}
      APPLICATIONINSIGHTS_CONNECTION_STRING: ${APPLICATIONINSIGHTS_CONNECTION_STRING}

# Hook configurations
hooks:
  postdeploy:
    shell: pwsh
    run: |
      echo "üöÄ AI Doctor deployment completed!"
      echo "üì± Frontend URL: $env:WEB_URI"
      echo "üîó API URL: $env:API_URI"
      echo "‚ö° Functions URL: $env:FUNCTIONS_URI"
      echo "üìä Application Insights: Navigate to Azure Portal"

  predeploy:
    shell: pwsh
    run: |
      echo "üîÑ Preparing AI Doctor deployment..."
      echo "üîç Validating infrastructure templates..."